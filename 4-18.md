# 4月18日 Debug日志：文章HTML内容获取功能修复

## 问题描述

在访问文章HTML内容时，前端报错：
```
GET http://localhost:5173/api/crawler/articles/2 405 (Method Not Allowed)
```

错误发生在 `ArticleHtml.vue` 的第52行：
```javascript
const articleResponse = await axios.get(`/api/crawler/articles/${id}`)
```

## 问题分析

### 1. 数据库结构
```
article_table       ────外键────>   article_full_html
  id (PK)                         article_id (FK, UNI)
（文章唯一标识）                    （关联文章主键）
```

### 2. 前端请求流程
1. 通过 `/api/crawler/articles/${id}` 获取文章基本信息
2. 通过 `/api/crawler/${id}/html` 获取HTML内容

### 3. 后端API实现
```java
// CrawlerController.java

// 获取所有文章
@GetMapping("/articles")
public ResponseEntity<List<Article>> getArticles() { ... }

// 获取HTML内容
@GetMapping("/{id}/html")
public ResponseEntity<?> getArticleHtml(@PathVariable Integer id) { ... }
```

### 4. 问题定位
- 405错误（Method Not Allowed）表示请求的HTTP方法不被允许
- 检查发现后端缺少获取单个文章的API接口：`GET /api/crawler/articles/{id}`
- 虽然有获取HTML内容的接口，但是前端需要先获取文章基本信息

## 解决方案

1. 在`CrawlerController.java`中添加获取单个文章的接口：
```java
@GetMapping("/articles/{id}")
public ResponseEntity<?> getArticleById(@PathVariable Integer id) {
    try {
        Article article = articleMapper.findById(id);
        if (article == null) {
            return ResponseEntity.notFound().build();
        }
        return ResponseEntity.ok(article);
    } catch (Exception e) {
        return ResponseEntity.status(500).body("获取文章失败：" + e.getMessage());
    }
}
```

2. 完整的数据流程：
   - 前端通过 `/api/crawler/articles/${id}` 获取文章基本信息（从`article_table`）
   - 后端返回文章基本信息
   - 前端通过 `/api/crawler/${id}/html` 获取HTML内容（从`article_full_html`）
   - 后端通过外键关系查询并返回HTML内容

## 验证要点

1. 数据库外键关系正确：
   - `article_full_html.article_id` 正确关联到 `article_table.id`
   - SQL查询使用正确的关联字段

2. API响应格式：
   - `/api/crawler/articles/${id}` 返回文章基本信息
   - `/api/crawler/${id}/html` 返回 `{title: string, fullHtml: string}`

3. 错误处理：
   - 文章不存在时返回404
   - HTML内容不存在时返回404
   - 其他错误返回500

## 经验总结

1. API设计原则：
   - 遵循RESTful设计规范
   - 保持URL路径语义清晰
   - 合理设计响应格式

2. 数据流程设计：
   - 保持前后端数据流程一致
   - 确保数据库关联关系正确
   - 合理处理错误情况

3. Debug技巧：
   - 通过HTTP状态码快速定位问题
   - 检查API路径匹配
   - 验证数据库查询逻辑 